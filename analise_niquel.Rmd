---
title: "Métodos de Bioinformática"
author: "Guilherme Muniz"
date: "6 de dezembro de 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Introdução
#Niquel é o vigésimo quarto elemento químico mais abundante na Terra, podendo ser encontrado em plantas, animais e até mesmo no solo, o níquel se inclui na regra que diz que o excesso faz mal. Sendo um metal de transição forte, maleável, resistente à corrosão e que se mistura bem com outros metais, suas características fazem com que seja muito utilizado na criação dos mais variados objetos.
#Pelo menos, 19 tipos de tumor - entre eles os de pulmão, pele, fígado, laringe, bexiga e leucemias - estão relacionados à ocupação e ao ambiente de trabalho. E trabalhadores de algumas profissões, como as de cabeleireiro, piloto de avião, comissário de bordo, farmacêutico, químico e enfermeiro, são muito mais propensos ao desenvolvimento desses tumores. 
#No artigo publicado, os estudos que examinam os perfis de expressão gênica em resposta à exposição a compostos de níquel que foram realizados utilizando sistemas de cultura de tecidos in vitro.
#Aqui, comparamos os perfis de expressão gênica em células mononucleares de sangue periférico (PMCs) de oito trabalhadores de refinaria de níquel em Jinchang, na China, para os perfis de expressão de indivíduos referentes com apenas exposição ambiental.


#Carregando as bibliotecas necessárias
```{r}
library(Biobase)
library(GEOquery)
library(limma)
library(ggplot2)
library(affy)
library(preprocessCore)
```

#Obtendo os dados NCBI e a plataforma com a assinatura dos genes

```{r}
gSet <- getGEO("GSE40392", GSEMatrix =TRUE)
geneSignature <- getGEO("GPL6244", destdir=".")
gene <- data.frame(Table(geneSignature))
gSet <- gSet[[1]]
data <- exprs(gSet)
data.anno <- pData(gSet)
```

#Classificando em grupos:environmental and occupational

```{r}
grupo <- levels(data.anno$characteristics_ch1.1)
grupos = NULL
for(i in 1:length(grupo))
{
  grupos[i] <- dimnames(data.anno[data.anno$characteristics_ch1.1  == grupo[i], ])[1]
}

data <- data[, c(grupos[[1]], grupos[[2]]) ]
```

#Exibe quantidade de NA na tabela data

```{r}
# Quantidade NA na tabela data
table(is.na(data))
```

#Plot environmental exposure vs Occupational exposure

```{r}
vs <- matrix(nrow = dim(data)[1], ncol = 2)
for(i in 1:dim(data)[1])
{
    vs[i, 1] <- mean(data[i,grupos[[1]]])
    vs[i, 2] <- mean(data[i,grupos[[2]]])
}
plot(vs,xlab = "Environmental", ylab= "Occupational", main="Environmental exposure vs. Occupational exposure")
lines(lowess(vs), col = 2,lwd=2)
```

#Calculo e Plot do Coeficiente de Variancia CV

```{r}
# cv vs. mean plot
data.mean <- apply(data,1,mean) 
data.sd <- apply(data,1,sd) 
data.cv <- data.sd/data.mean 
plot(data.mean, data.cv,main="CV vs. Média", xlab="Média", ylab="CV", col='red4', cex=0.5)

```

#Normalizaçao

```{r}
ma.plot( rowMeans(log2(data[])), log2(data[, 1])-log2(data[, 2]), cex=1 )
dat.norm <- normalize.quantiles(data)
rownames(dat.norm) = rownames(data)
colnames(dat.norm) = colnames(data)
ma.plot( rowMeans(log2(dat.norm)), log2(dat.norm[, 1])-log2(dat.norm[, 2]), cex=1 )
```

#Dendograma

```{r}
plot(hclust(dist(t(dat.norm))),main = "Dendograma");
```

#PCA

```{r}
pca = prcomp(t(dat.norm))
col.groups = c(rep("red1", 9) , rep("red4", 9)) 
plot(pca$x[, 1:2], pch = 20, col = col.groups, 
     main = "PCA - Environmental exposure group e Occupational exposure group", 
     xlab = paste0("PC1 ", prettyNum(summary(pca)$importance[2,1]*100, digits = 2), "%"),
     ylab = paste0("PC2 ",prettyNum(summary(pca)$importance[2,2]*100, digits = 2 ), "%"))


```

#Analise supervisionada

```{r}

my.t.test.p.value <- function(...) {
  obj<-try(t.test(...), silent=TRUE)
  if (is(obj, "try-error")) return(NA) else return(obj$p.value)
}
pval = apply(data,1,function(x) {my.t.test.p.value(x[colnames(data)[1:9]],x[colnames(data)[10:18]])})

dat1 = as.data.frame(data)
dat1$pval = pval
dat1$p.adj = p.adjust(dat1$pval, method = "BH")
dat1$meanEnv = apply(data[, 1:9], 1, mean, na.rm = T)
dat1$meanOcc = apply(data[, 10:18], 1, mean, na.rm = T)
dat1$FC = dat1$meanEnv - dat1$meanOcc
dat1$STATUS = "NOT.SIG" 
dat1[dat1$p.adj < 0.05 & dat1$FC < 0 ,]$STATUS = "Down"
dat1[dat1$p.adj < 0.05 & dat1$FC > 0 , ]$STATUS = "Up"
```

#Volcano plot

```{r}
library(ggplot2)
ggplot(dat1, aes(x = FC, y = -log10(p.adj))) +
  geom_point(aes(color = STATUS), cex = 1.45) +
  scale_color_manual(values = c("SpringGreen4", "grey", "red4")) +
  theme_bw(base_size = 12) + theme(legend.position = "bottom") +
  xlab("Fold Change") +
  ylab("-log10 adjusted PValue") + 
  geom_hline(yintercept = 1.30, size = .25) +
  labs(title = "Volcano plot - Environmental group e Occupational exposure group ")
```


#Heatmap

```{r}
data.cor <- cor(dat.norm)
image (data.cor, axes=F, main = "Matriz de correlação")
```

#Conclusao
#Com os resultados obtidos, podemos concluir que há uma diferença estatística entre o grupo contendo as amostras de environmental exposure e o grupo das amostras de occupational exposure, o que demonstra que existe uma correlação que favorece o desenvolvimento de cancer em alguns pacientes.

